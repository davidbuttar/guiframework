/*
* Project: guiframework
* Version: 1.0.0 (2014-02-14)
* Development By: Grapeshot Ltd
* Copyright(c): 2014
*/
"use strict";var gui=gui||{};!function(){var a=function(a){function b(){$("#"+x).animate({opacity:0},150,function(){d(),setTimeout(function(){$("#"+w).css({left:"0px"}),h(),$("#"+w).animate({opacity:1},500),u[w].onload(),A=!1},200)})}function c(a,b){var c="page";u[b]=-1!==a.className.indexOf(c)?a.getAttribute("data-handler")?gui[a.getAttribute("data-handler")]():gui.component():gui.component(),c="component";for(var d=$(a).find("."+c+" , .page"),e=0,f=d.length;f>e;e++)$(d[e]).hasClass("page")&&$(d[e]).removeClass("page").addClass("component"),d[e].getAttribute("data-handler")&&(v[d[e].getAttribute("id")]||(v[d[e].getAttribute("id")]=gui[d[e].getAttribute("data-handler")](),v[d[e].getAttribute("id")].onload()));var g=$(a).find(".ajax");g[0]&&$.ajax({url:g[0].getAttribute("data-loc")}).done(function(a){$(g[0]).after($(a).find("#main-inner").html()).remove()})}function d(){$("#"+x).removeClass("comp-active"),$("#"+w).addClass("comp-active")}function e(){x=$(".comp-active").attr("id")}function f(a,b){return a+"To"+b.charAt(0).toUpperCase()+b.slice(1)}function g(){if(m(),e(),x){var a=$("#"+x).data("effect")||"fade",c=$("#"+w).data("effect")||"fade",d=f(a,c);E[d]?E[d]():x===w?(u[w].onload(),A=!1,h()):b()}else $("#"+w).addClass("comp-active"),h(),$("#"+w).animate({opacity:1},500),u[w].onload(),A=!1}function h(){if(B){var a=B;B=!1,a()}u[w].onvisible()}function i(){var a=$("#"+w);$("input").placeholder(),c(a[0],w),k()}function j(a){var b=t?"?ajax=true":"&ajax=true";1===$("#"+w).length?i():$.ajax({url:s+a+b,error:function(){gui.msg.error("Page fetch unsuccessful"),A=!1},success:function(a){if(-1!==a.indexOf("DOCTYPE"))return void console.error("Error loading incorrect page type");-1!==a.indexOf("not_found")&&(w="index_not_found");var b=$("#"+w);0===b.length&&(b=$(a).prependTo(".main-content")),i()}})}function k(){z?z(function(){u[w].loadData(g),o.updateObservers(),z=!1}):(u[w].loadData(g),o.updateObservers())}function l(){gui.msg.loading(function(){x&&$("#"+x).animate({opacity:0},150)})}function m(){gui.msg.loaded(),A=!1,C&&$("#"+w).stop(!0,!0).animate({opacity:1},150)}function n(a){var b,c,d;return t?(a=a.replace(/^\//,"").replace(/\/$/,""),d=a.split("/"),b=d[0]||"index",c=d[1]||"index"):(b=gui.getParameterByName("c",a),c=gui.getParameterByName("a",a)),b+"_"+c}var o={};a=a||{};var p,q,r=a.defaultRoute||"/index/index/",s=a.indexFile||"",t="undefined"!=typeof a.prettyUrl?a.prettyUrl:!0,u={},v={},w=!1,x=!1,y=a.observers||[],z=a.onFirstLoad||!1,A=!1,B=!1,C=!1,D=$("#static_page").length>=1,E={};return E.fadeToSlideUp=function(){$("#"+x).animate({opacity:0},600,function(){d(),$("#"+w).css({top:"100%"}).animate({opacity:1,top:"0px"},{duration:300,specialEasing:{top:"linear"},complete:h}),u[w].onload(),A=!1})},E.slideUpToSlideUp=function(){$("#"+x).animate({top:"100%"},500,function(){$("#"+x).css({top:"0px",opacity:0}),d(),$("#"+w).css({top:"100%"}).animate({opacity:1,top:"0px"},500,h),u[w].onload(),A=!1})},E.slideDownToFade=function(){$("#"+x).animate({top:"100%"},600,function(){$("#"+x).css({top:"0px",opacity:0}),d(),$("#"+w).animate({opacity:1},300,h),u[w].onload(),A=!1})},o.updateObservers=function(){for(var a=0,b=y.length;b>a;a++)y[a](w)},o.fetching=function(a){A=a},o.isFetching=function(){return A},o.back=function(){window.location.hash=q||r},o.addObserver=function(a){y.push(a)},o.handler=function(a){return u[a]?u[a]:!1},o.component=function(a){return v[a]?v[a]:!1},o.loadComponents=function(a,b){for(var c=b||"component",d=a||"body",e=$(d).find("."+c),f=0,g=e.length;g>f;f++)e[f].getAttribute("data-handler")&&(v[e[f].getAttribute("id")]||(v[e[f].getAttribute("id")]=gui[e[f].getAttribute("data-handler")](),v[e[f].getAttribute("id")].onload()));$(window).hashchange()},o.page=function(a,b){o.pageVisible(b),"?"+a!==p?window.location.hash="#?"+a:h()},o.pageVisible=function(a){B=a},$(window).hashchange(function(){if(!D){if(A)return void(p&&(location.hash=p));A=!0,q=p,p=location.hash.replace("#",""),""===p&&(p=r),x=w||n(p),w=n(p),l(),C=x===w&&u[x]&&u[x].changed,x&&u[x]&&(C?u[x].changed():u[x].unload()),u[w]?C||k():j(p)}}),o};gui.framework=a}(),function(){var a=function(a){var b={};return a=a||{},b.onload=function(){},b.onvisible=function(){},b.loadData=function(a){a()},b.unload=function(){},b};gui.component=a}(),function(){var a=function(){function a(){n&&(n.css("top",($(window).height()-n.outerHeight())/2+$(window).scrollTop()+"px"),n.css("left",($(window).width()-n.outerWidth())/2+$(window).scrollLeft()+"px"))}function b(a,b){a.id&&(l[a.id]=a,m=a,b||c())}function c(a){return a&&"undefined"==typeof l[a]?!1:(a&&(m=l[a]),e(),!0)}function d(){f()}function e(){k.showOverlay(),g(),$("#gui-overlay").animate({opacity:.4},300)}function f(){j(),$("#gui-overlay").animate({opacity:0},300,function(){$("#gui-overlay").css({display:"none"})})}function g(){return document.getElementById("pm_"+m.id)||i(),n=$("#pm_"+m.id),n.css({display:"block"}),a(),n}function h(){if(m.url)return"<iframe src='"+m.url+"' horizontalscrolling='no' verticalscrolling='no' width='"+m.width+"' height='"+m.height+"' frameBorder='0'></iframe>";if(m.selector){var a=$(m.selector).html();return a}}function i(){var a=h(),b="";m.ok&&(b="<div class='pm-popup-buttons'> <button class='button'>OK</button></div>");var c="<div id='pm_"+m.id+"' class='pm_popup'><div class='pm-popup-inner'> "+a+b+"</div></div>",e=$(c).appendTo("body");m.ok&&e.find(".button").click(function(){$(window).scrollTop(0),d(),m.ok()})}function j(){$("#pm_"+m.id).css({display:"none"})}var k={},l={},m={},n=!1;return $(window).resize(function(){$("#gui-overlay").length&&"block"===$("#gui-overlay").css("display")&&($("#pm_channel-help h1").text($(document).height()),$("#gui-overlay").css({height:"auto"}),$("#gui-overlay").css({height:$(document).height()}),a())}),$(document).on("click",".pm_close",function(){d()}),$(document).on("click",".pm_popup",function(a){a.stopPropagation()}),k.showOverlay=function(){document.getElementById("gui-overlay")||$("body").append("<div id='gui-overlay' style='opacity:0;'>&nbsp;</div>"),$("#gui-overlay").css({display:"block",height:$(document).height()})},k.show=c,k.hide=d,k.add=b,k};gui.popups=a()}(),function(){var a=function(a){function b(a){a.css("top",($(window).height()-a.outerHeight())/2+$(window).scrollTop()+"px"),a.css("left",($(window).width()-a.outerWidth())/2+$(window).scrollLeft()+"px")}function c(a,b){h||($("#gui-dialog-cancel").click(function(a){a.preventDefault(),d.hideDialog()}),h=!0),$("#gui-dialog-ok").unbind(),$("#gui-dialog-ok").bind("click",function(){d.hideDialog(b),a()})}var d={};a=a||{};var e,f,g=400,h=!1,i=3200;return d.loading=function(a){e=setTimeout(function(){$("#gui-loading").show(),b($("#gui-loading")),a&&a()},g)},d.loaded=function(){clearTimeout(e),$("#gui-loading").hide()},d.showOverlay=function(){$("#gui-overlay").stop(),gui.popups.showOverlay(),$("#gui-overlay").animate({opacity:.4},300)},d.hideOverlay=function(){$("#gui-overlay").animate({opacity:0},300,function(){$("#gui-overlay").css({display:"none"})})},d.dialog=function(a,e,f,g,h){c(e,f),d.showOverlay(),$("#gui-dialog").removeClass("no-cancel"),g&&$("#gui-dialog").addClass("no-cancel"),"undefined"!=typeof h&&h?$("#gui-dialog").find(".message-dialog").html(a):$("#gui-dialog").find(".message-dialog").text(a),$("#gui-dialog").show(),b($("#gui-dialog"))},d.hideDialog=function(a){a||d.hideOverlay(),$("#gui-dialog").hide()},d.general=function(a,c){var e=c||i;d.hide(),clearTimeout(f),$("#gui-general").show(),$("#gui-general").find(".message-type").html(a),b($("#gui-general")),f=setTimeout(function(){$("#gui-general").hide()},e)},d.error=function(a){a=a||"Unknown failure",d.hide(),$("#gui-error").find(".message-error").text(a),$("#gui-error").show(),b($("#gui-error"))},d.hide=function(){d.hideOverlay(),$(".message").hide()},$(document).on("click","#error-ok",function(){$(".message").hide("slow"),d.hideOverlay()}),d};gui.msg=a()}();