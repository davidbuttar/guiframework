/*
* Project: guiframework
* Version: 1.0.0 (2014-02-19)
* Development By: David Buttar
* Copyright(c): 2014
*/
"use strict";var gui=gui||{};!function(){var a=function(a){function b(){$("#"+x).animate({opacity:0},150,function(){d(),setTimeout(function(){$("#"+w).css({left:"0px"}),h(),$("#"+w).animate({opacity:1},500),u[w].onload(),B=!1},200)})}function c(a,b){var c="page";if(!a)return void(u[b]=gui.component());u[b]=-1!==a.className.indexOf(c)?a.getAttribute("data-handler")?gui[a.getAttribute("data-handler")]():gui.component():gui.component(),c="component";for(var d=$(a).find("."+c+" , .page"),e=0,f=d.length;f>e;e++)$(d[e]).hasClass("page")&&$(d[e]).removeClass("page").addClass("component"),d[e].getAttribute("data-handler")&&(v[d[e].getAttribute("id")]||(v[d[e].getAttribute("id")]=gui[d[e].getAttribute("data-handler")](),v[d[e].getAttribute("id")].onload()));var g=$(a).find(".ajax");g[0]&&$.ajax({url:g[0].getAttribute("data-loc")}).done(function(a){$(g[0]).after($(a).find("#main-inner").html()).remove()})}function d(){$("#"+x).removeClass("comp-active"),$("#"+w).addClass("comp-active")}function e(){x=$(".comp-active").attr("id")}function f(a,b){return a+"To"+b.charAt(0).toUpperCase()+b.slice(1)}function g(){if(m(),e(),x){var a=$("#"+x).data("effect")||"fade",c=$("#"+w).data("effect")||"fade",g=f(a,c);F[g]?F[g]($("#"+x),$("#"+w),d,h,u[w].onload):x===w?(u[w].onload(),B=!1,h()):b()}else $("#"+w).addClass("comp-active"),h(),$("#"+w).animate({opacity:1},500),u[w].onload(),B=!1}function h(){if(C){var a=C;C=!1,a()}u[w].onvisible()}function i(){var a=$("#"+w);z&&z(),c(a[0],w),k()}function j(a){var b=t?"?ajax=true":"&ajax=true";1===$("#"+w).length?i():$.ajax({url:s+a+b,error:function(){gui.msg.error("Page fetch unsuccessful"),B=!1},success:function(a){if(-1!==a.indexOf("DOCTYPE"))return void console.error("Error loading incorrect page type");-1!==a.indexOf("not_found")&&(w="index_not_found");var b=$("#"+w);0===b.length&&(b=$(a).prependTo(".main-content")),i()}})}function k(){A?A(function(){u[w].loadData(g),o.updateObservers(),A=!1}):(u[w].loadData(g),o.updateObservers())}function l(){gui.msg.loading(function(){x&&$("#"+x).animate({opacity:0},150)})}function m(){gui.msg.loaded(),B=!1,D&&$("#"+w).stop(!0,!0).animate({opacity:1},150)}function n(a){var b,c,d;return t?(a=a.replace(/^\//,"").replace(/\/$/,""),d=a.split("/"),b=d[0]||"index",c=d[1]||"index"):(b=gui.getParameterByName("c",a),c=gui.getParameterByName("a",a)),b+"_"+c}var o={};a=a||{};var p,q,r=a.defaultRoute||"/index/index/",s=a.indexFile||"",t="undefined"!=typeof a.prettyUrl?a.prettyUrl:!0,u={},v={},w=!1,x=!1,y=a.observers||[],z=a.htmlEnhancement||!1,A=a.onFirstLoad||!1,B=!1,C=!1,D=!1,E=$("#static_page").length>=1,F={};return gui.popups=gui.popupManager(o),o.updateObservers=function(){for(var a=0,b=y.length;b>a;a++)y[a](w)},o.fetching=function(a){B=a},o.isFetching=function(){return B},o.back=function(){window.location.hash=q||r},o.addObserver=function(a){y.push(a)},o.addEffect=function(a,b){F[a]=b},o.handler=function(a){return u[a]?u[a]:!1},o.component=function(a){return v[a]?v[a]:!1},o.loadComponents=function(a,b){for(var c=b||"component",d=a||"body",e=$(d).find("."+c),f=0,g=e.length;g>f;f++)e[f].getAttribute("data-handler")&&(v[e[f].getAttribute("id")]||(v[e[f].getAttribute("id")]=gui[e[f].getAttribute("data-handler")](),$(e[f]).hasClass("pm_popup")||v[e[f].getAttribute("id")].onload()));$(window).hashchange()},o.page=function(a,b){o.pageVisible(b),"?"+a!==p?window.location.hash="#?"+a:h()},o.pageVisible=function(a){C=a},$(window).hashchange(function(){if(!E){if(B)return void(p&&(location.hash=p));B=!0,q=p,p=location.hash.replace("#",""),""===p&&(p=r),x=w||n(p),w=n(p),l(),D=x===w&&u[x]&&u[x].changed,x&&u[x]&&(D?u[x].changed():u[x].unload()),u[w]?D||k():j(p)}}),o};gui.framework=a}(),function(){var a=function(a){var b={};return a=a||{},b.onload=function(){},b.onvisible=function(){},b.loadData=function(a){a()},b.unload=function(){},b};gui.component=a}(),function(){var a=function(a){function b(){o&&(o.css("top",($(window).height()-o.outerHeight())/2+$(window).scrollTop()+"px"),o.css("left",($(window).width()-o.outerWidth())/2+$(window).scrollLeft()+"px"))}function c(a,b){a.id&&(m[a.id]=a,n=a,b||d())}function d(a){return a&&"undefined"==typeof m[a]?!1:(a&&(n=m[a]),f(),!0)}function e(){g()}function f(){l.showOverlay(),h(),$("#gui-overlay").animate({opacity:.4},300)}function g(){k(),$("#gui-overlay").animate({opacity:0},300,function(){$("#gui-overlay").css({display:"none"})})}function h(){document.getElementById("pm_"+n.id)||j();var c=a.component("pm_"+n.id);return c&&c.onload(),o=$("#pm_"+n.id),o.css({display:"block"}),b(),o}function i(){if(n.url)return"<iframe src='"+n.url+"' horizontalscrolling='no' verticalscrolling='no' width='"+n.width+"' height='"+n.height+"' frameBorder='0'></iframe>";if(n.selector){var a=$(n.selector).html();return a}}function j(){var a=i(),b="";n.ok&&(b="<div class='pm-popup-buttons'> <button class='button'>OK</button></div>");var c="<div id='pm_"+n.id+"' class='pm_popup'><div class='pm-popup-inner'> "+a+b+"</div></div>",d=$(c).appendTo("body");n.ok&&d.find(".button").click(function(){$(window).scrollTop(0),e(),n.ok()})}function k(){$("#pm_"+n.id).css({display:"none"})}var l={},m={},n={},o=!1;return $(window).resize(function(){$("#gui-overlay").length&&"block"===$("#gui-overlay").css("display")&&($("#pm_channel-help h1").text($(document).height()),$("#gui-overlay").css({height:"auto"}),$("#gui-overlay").css({height:$(document).height()}),b())}),$(document).on("click",".pm_close",function(){e()}),$(document).on("click",".pm_popup",function(a){a.stopPropagation()}),l.showOverlay=function(){document.getElementById("gui-overlay")||$("body").append("<div id='gui-overlay' style='opacity:0;'>&nbsp;</div>"),$("#gui-overlay").css({display:"block",height:$(document).height()})},l.show=d,l.hide=e,l.add=c,l};gui.popupManager=a}(),function(){var a=function(a){function b(a){a.css("top",($(window).height()-a.outerHeight())/2+$(window).scrollTop()+"px"),a.css("left",($(window).width()-a.outerWidth())/2+$(window).scrollLeft()+"px")}function c(a,b){j||($("#gui-dialog-cancel").click(function(a){a.preventDefault(),f.hideDialog()}),j=!0),$("#gui-dialog-ok").unbind(),$("#gui-dialog-ok").bind("click",function(){f.hideDialog(b),a&&a()})}function d(a,b,c){function d(b){var d=$("#input-dialog-input").val(),g=c?c(d):!0;if(g===!0)f.hideInputDialog(b),a&&a(d);else{var h=g===!1?"Invalid value, please try again.":g;e(h)}}$("#input-dialog-cancel").unbind(),$("#input-dialog-cancel").click(function(a){a.preventDefault(),f.hideInputDialog(b)}),$("#input-dialog-ok").unbind(),$("#input-dialog-ok").bind("click",function(){d(b)}),$("#input-dialog-input").unbind(),$("#input-dialog-input").bind("keypress",function(a){13===a.which&&d(b)})}function e(a){$("#input-dialog-input").addClass("gui-form-error").focus().select(),$("#input-dialog-invalid").show().text(a)}var f={};a=a||{};var g,h,i=400,j=!1,k=3200;return f.loading=function(a){g=setTimeout(function(){$("#gui-loading").show(),b($("#gui-loading")),a&&a()},i)},f.loaded=function(){clearTimeout(g),$("#gui-loading").hide()},f.showOverlay=function(){$("#gui-overlay").stop(),gui.popups.showOverlay(),$("#gui-overlay").animate({opacity:.4},300)},f.hideOverlay=function(){$("#gui-overlay").animate({opacity:0},300,function(){$("#gui-overlay").css({display:"none"})})},f.dialog=function(a,d,e,g,h){c(d,e),f.showOverlay(),$("#gui-dialog").removeClass("no-cancel"),g&&$("#gui-dialog").addClass("no-cancel"),"undefined"!=typeof h&&h?$("#gui-dialog").find(".message-dialog").html(a):$("#gui-dialog").find(".message-dialog").text(a),$("#gui-dialog").show(),b($("#gui-dialog"))},f.hideDialog=function(a){a||f.hideOverlay(),$("#gui-dialog").hide()},f.hideInputDialog=function(a){a||f.hideOverlay(),$("#gui-input-dialog").hide()},f.general=function(a,c){var d=c||k;f.hide(),clearTimeout(h),$("#gui-general").show(),$("#gui-general").find(".message-type").html(a),b($("#gui-general")),h=setTimeout(function(){$("#gui-general").hide()},d)},f.error=function(a){a=a||"Unknown failure",f.hide(),$("#gui-error").find(".message-error").text(a),$("#gui-error").show(),b($("#gui-error"))},f.prompt=function(a){var c=a||{},e=c.heading||!1,g=c.label||!1,h=c.success||!1,i=c.valid||!1,j=c.keepOverlay||!1;d(h,j,i),f.showOverlay(),$("#input-dialog-input").removeClass("gui-form-error").val(""),$("#input-dialog-invalid").hide(),e?($("#gui-input-dialog").find(".message-type").show(),$("#gui-input-dialog").find(".message-dialog").text(e)):$("#gui-input-dialog").find(".message-type").hide(),$("#gui-input-dialog").find(".gui-label").text(g),$("#gui-input-dialog").show(),b($("#gui-input-dialog")),$("#input-dialog-input").focus()},f.hide=function(){f.hideOverlay(),$(".message").hide()},f.centerMessage=b,$(document).on("click","#error-ok",function(){$(".message").hide("slow"),f.hideOverlay()}),f};gui.msg=a()}();